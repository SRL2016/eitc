"B02001_004", #native
"B02001_005", #asian
"B02001_006", #pacific islanders
"B09001_001", #ageunder18
"B06001_004", #age18to24
"B06001_005", #age25to34
"B06001_006", #age35to44
"B06001_007", #age45to54
"B06001_008",
"B06001_009",
"B06001_010", #age55to64
"B06001_011", #age65to74
"B06001_012" #ageover75
),
year = 2016,
output = "wide",
geometry = FALSE,
state = 'CO'
) %>%
inner_join(
get_acs(geography = "state legislative district (lower chamber)",
variables = c(
"S1601_C01_001", #population age>5year
"S1601_C01_002", #english
"S1601_C01_004" #spanish
),
year = 2016,
output = "wide",
geometry = FALSE,
state = 'CO'
),
by=c("GEOID"="GEOID")
) %>%
mutate(
ageunder18=B09001_001E/B01001_001E*100,
age18to24=B06001_004E/B01001_001E*100,
age25to34=B06001_005E/B01001_001E*100,
age35to44=B06001_006E/B01001_001E*100,
age45to54=B06001_007E/B01001_001E*100,
age55to64=(B06001_008E+B06001_009E+B06001_010E)/B01001_001E*100,
age65to74=B06001_011E/B01001_001E*100,
ageover75=B06001_012E/B01001_001E*100,
other_languages=S1601_C01_001E-S1601_C01_002E-S1601_C01_004E,
asian_pacific = B02001_005E + B02001_006E
) %>%
select(
geoid10 = GEOID,
total_population = B01001_001E,
nonhiswhite = B03002_003E,
hislat = B03002_012E,
black = B02001_003E,
native = B02001_004E,
asian_pacific,
ageunder18,
age18to24,
age25to34,
age35to44,
age45to54,
age55to64,
age65to74,
ageover75,
english_spk = S1601_C01_002E,
spanish_spk = S1601_C01_004E,
other_languages,
poverty_de = B17020_001E,
poverty_nu = B17020_002E
)
hdist_prv <- st_read(proj_con,c("eitc","house_state_geography")) %>% select(geoid10=geoid,geom) %>% st_set_crs(4326) %>%
st_join(chfa %>% st_set_crs(4326) %>% select(totalnumberofunits), join = st_contains, left = TRUE) %>%
group_by(geoid10) %>%
summarise(aff_units= sum(totalnumberofunits))
hdist_rpt <- hdist_prv %>%
#inner_join(hdist_eitc) %>%
inner_join(hdist_qual) %>%
inner_join(hdist_demo)
View(hdist_rpt)
st_write(hdist_rpt, proj_con, c("eitc","hdist_state_eitc_rpt"), overwrite = TRUE)
View(hdist_rpt)
sdist_qual <- get_acs(geography = "state legislative district (upper chamber)",
variables = c("B19131_001",
"B19131_004",
"B19131_005",
"B19131_006",
"B19131_007",
"B19131_008",
"B19131_009",
"B19131_010",
"B19131_011",
"B19131_012",
"B19131_040",
"B19131_041",
"B19131_042",
"B19131_043",
"B19131_044",
"B19131_045",
"B19131_046",
"B19131_047",
"B19131_048",
"B19131_075",
"B19131_076",
"B19131_077",
"B19131_078",
"B19131_079",
"B19131_080",
"B19131_081",
"B19131_082",
"B19131_083",
"B19001_001",
"B19001_002", "B19001_003", "B19001_004", "B19001_005", "B19001_006", "B19001_007", "B19001_008","B19001_009","B19001_010"
),
year = 2016,
output = "wide",
state = "CO",
geometry = FALSE
) %>%
mutate(qual_fam = B19131_004E+
B19131_005E+
B19131_006E+
B19131_007E+
B19131_008E+
B19131_009E+
B19131_010E+
B19131_011E+
B19131_012E+
B19131_040E+
B19131_041E+
B19131_042E+
B19131_043E+
B19131_044E+
B19131_045E+
B19131_046E+
B19131_047E+
B19131_048E+
B19131_075E+
B19131_076E+
B19131_077E+
B19131_078E+
B19131_079E+
B19131_080E+
B19131_081E+
B19131_082E+
B19131_083E,
qual_hh = B19001_002E + B19001_003E + B19001_004E + B19001_005E + B19001_006E
+ B19001_007E + B19001_008E + B19001_009E + B19001_010E
) %>%
mutate(name= substr(NAME, 1, nchar(NAME)-16), qual_share = qual_fam/B19131_001E) %>%
select(geoid10 = GEOID, name, ttl_hh = B19001_001E, qual_hh, ttl_fam=B19131_001E, qual_fam, qual_share)
sdist_demo <- get_acs(geography = "state legislative district (upper chamber)",
variables = c(
"B01001_001", #total population
"B17020_001", #poverty demoninator
"B17020_002", #poverty numerator
"B03002_003", #non-hispanic white
"B03002_012", #hispanic&latino
"B02001_003", #black
"B02001_004", #native
"B02001_005", #asian
"B02001_006", #pacific islanders
"B09001_001", #ageunder18
"B06001_004", #age18to24
"B06001_005", #age25to34
"B06001_006", #age35to44
"B06001_007", #age45to54
"B06001_008",
"B06001_009",
"B06001_010", #age55to64
"B06001_011", #age65to74
"B06001_012" #ageover75
),
year = 2016,
output = "wide",
geometry = FALSE,
state = 'CO'
) %>%
inner_join(
get_acs(geography = "state legislative district (upper chamber)",
variables = c(
"S1601_C01_001", #population age>5year
"S1601_C01_002", #english
"S1601_C01_004" #spanish
),
year = 2016,
output = "wide",
geometry = FALSE,
state = 'CO'
),
by=c("GEOID"="GEOID")
) %>%
mutate(
ageunder18=B09001_001E/B01001_001E*100,
age18to24=B06001_004E/B01001_001E*100,
age25to34=B06001_005E/B01001_001E*100,
age35to44=B06001_006E/B01001_001E*100,
age45to54=B06001_007E/B01001_001E*100,
age55to64=(B06001_008E+B06001_009E+B06001_010E)/B01001_001E*100,
age65to74=B06001_011E/B01001_001E*100,
ageover75=B06001_012E/B01001_001E*100,
other_languages=S1601_C01_001E-S1601_C01_002E-S1601_C01_004E,
asian_pacific = B02001_005E + B02001_006E
) %>%
select(
geoid10 = GEOID,
total_population = B01001_001E,
nonhiswhite = B03002_003E,
hislat = B03002_012E,
black = B02001_003E,
native = B02001_004E,
asian_pacific,
ageunder18,
age18to24,
age25to34,
age35to44,
age45to54,
age55to64,
age65to74,
ageover75,
english_spk = S1601_C01_002E,
spanish_spk = S1601_C01_004E,
other_languages,
poverty_de = B17020_001E,
poverty_nu = B17020_002E
)
sdist_prv <- st_read(proj_con,c("eitc","senate_state_geography")) %>% select(geoid10=geoid,geom) %>% st_set_crs(4326) %>%
st_join(chfa %>% st_set_crs(4326) %>% select(totalnumberofunits), join = st_contains, left = TRUE) %>%
group_by(geoid10) %>%
summarise(aff_units= sum(totalnumberofunits))
sdist_rpt <- sdist_prv %>%
#  inner_join(sdist_eitc) %>%
inner_join(sdist_qual) %>%
inner_join(sdist_demo)
View(sdist_rpt)
st_write(sdist_rpt, proj_con, c("eitc","sdist_state_eitc_rpt"), overwrite = TRUE)
puma_units <- st_read(proj_con, c("eitc","puma_state_geography")) %>%
rmapshaper::ms_simplify(keep_shapes = TRUE) %>%
left_join(dbReadTable(proj_con, c("eitc", "HighLevelTest_EITCGap SummaryQualTaxUnits")), by = c("geoid10"="GEOID")) %>%
select(geoid10, name10, single, single_nonfam, single_parent, married, EstEITC_QTU)
proj_con <- dbConnect(dbDriver("PostgreSQL"), dbname = "project",
host = "sp63kb5w0r8p3p.ckswd2zr0ndt.us-west-2.rds.amazonaws.com", port = 5432,
user = readline("type in username"), password = readline("type in password"))
puma_units <- st_read(proj_con, c("eitc","puma_state_geography")) %>%
rmapshaper::ms_simplify(keep_shapes = TRUE) %>%
left_join(dbReadTable(proj_con, c("eitc", "HighLevelTest_EITCGap SummaryQualTaxUnits")), by = c("geoid10"="GEOID")) %>%
select(geoid10, name10, single, single_nonfam, single_parent, married, EstEITC_QTU)
charities <- st_read(proj_con, c("eitc", "community_facilities"))
rpt_lst <- list()
rpt_lst[[1]] <- st_read(proj_con,c("eitc","zip_state_eitc_rpt")) %>% rmapshaper::ms_simplify(keep_shapes = TRUE)
rpt_lst[[2]] <- st_read(proj_con,c("eitc","county_state_eitc_rpt")) %>% rmapshaper::ms_simplify(keep_shapes = TRUE)
rpt_lst[[3]] <- st_read(proj_con,c("eitc","hdist_state_eitc_rpt")) %>% rmapshaper::ms_simplify(keep_shapes = TRUE)
rpt_lst[[4]] <- st_read(proj_con,c("eitc","sdist_state_eitc_rpt")) %>% rmapshaper::ms_simplify(keep_shapes = TRUE)
names(rpt_lst) <- c("Zip Code","County","State House District","State Senate District")
View(rpt_lst)
View(puma_units)
rpt_index <- as.data.frame(
cbind(c("Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)",
"Total Tax Filers","# EITC Claims","% EITC Claims","EITC Amount",
"Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)",
"Total Tax Filers","# EITC Claims","% EITC Claims","EITC Amount",
"Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)",
"Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)"),
c("ttl_hh","qual_hh","ttl_fam","qual_fam",
"total_return","eitc_return","eitc_share","eitc_amnt",
"ttl_hh","qual_hh","ttl_fam","qual_fam",
"total_return","eitc_return","eitc_share","eitc_amnt",
"ttl_hh","qual_hh","ttl_fam","qual_fam",
"ttl_hh","qual_hh","ttl_fam","qual_fam"),
c("Zip Code","Zip Code","Zip Code","Zip Code","Zip Code","Zip Code","Zip Code","Zip Code",
"County","County","County","County","County","County","County","County",
"State House District","State House District","State House District","State House District","State House District","State House District","State House District","State House District",
"State Senate District","State Senate District","State Senate District","State Senate District","State Senate District","State Senate District","State Senate District","State Senate District"))
)
colnames(rpt_index) <- c("dropdown", "column","geography")
View(rpt_index)
rpt_index <- as.data.frame(
cbind(c("Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)",
"Total Tax Filers","# EITC Claims","% EITC Claims","EITC Amount",
"Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)",
"Total Tax Filers","# EITC Claims","% EITC Claims","EITC Amount",
"Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)",
"Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)"),
c("ttl_hh","qual_hh","ttl_fam","qual_fam",
"total_return","eitc_return","eitc_share","eitc_amnt",
"ttl_hh","qual_hh","ttl_fam","qual_fam",
"total_return","eitc_return","eitc_share","eitc_amnt",
"ttl_hh","qual_hh","ttl_fam","qual_fam",
"ttl_hh","qual_hh","ttl_fam","qual_fam"),
c("Zip Code","Zip Code","Zip Code","Zip Code","Zip Code","Zip Code","Zip Code","Zip Code",
"County","County","County","County","County","County","County","County",
"State House District","State House District","State House District","State House District",
"State Senate District","State Senate District","State Senate District","State Senate District"))
)
colnames(rpt_index) <- c("dropdown", "column","geography")
rpt_index <- as.data.frame(
cbind(c("Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)",
"Total Tax Filers","# EITC Claims","% EITC Claims","EITC Amount",
"Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)",
"Total Tax Filers","# EITC Claims","% EITC Claims","EITC Amount",
"Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)",
"Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)",
"EITC Qualitfied Units"),
c("ttl_hh","qual_hh","ttl_fam","qual_fam",
"total_return","eitc_return","eitc_share","eitc_amnt",
"ttl_hh","qual_hh","ttl_fam","qual_fam",
"total_return","eitc_return","eitc_share","eitc_amnt",
"ttl_hh","qual_hh","ttl_fam","qual_fam",
"ttl_hh","qual_hh","ttl_fam","qual_fam",
"EstEITC_QTU"),
c("Zip Code","Zip Code","Zip Code","Zip Code","Zip Code","Zip Code","Zip Code","Zip Code",
"County","County","County","County","County","County","County","County",
"State House District","State House District","State House District","State House District",
"State Senate District","State Senate District","State Senate District","State Senate District",
"Public Use Microdata Area"))
)
colnames(rpt_index) <- c("dropdown", "column","geography")
rpt_index <- as.data.frame(
cbind(c("Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)",
"Total Tax Filers","# EITC Claims","% EITC Claims","EITC Amount",
"Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)",
"Total Tax Filers","# EITC Claims","% EITC Claims","EITC Amount",
"Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)",
"Total Households","Households (Income < 50K)","Total Families","Families (Income < 50K with Own Children)"),
c("ttl_hh","qual_hh","ttl_fam","qual_fam",
"total_return","eitc_return","eitc_share","eitc_amnt",
"ttl_hh","qual_hh","ttl_fam","qual_fam",
"total_return","eitc_return","eitc_share","eitc_amnt",
"ttl_hh","qual_hh","ttl_fam","qual_fam",
"ttl_hh","qual_hh","ttl_fam","qual_fam"),
c("Zip Code","Zip Code","Zip Code","Zip Code","Zip Code","Zip Code","Zip Code","Zip Code",
"County","County","County","County","County","County","County","County",
"State House District","State House District","State House District","State House District",
"State Senate District","State Senate District","State Senate District","State Senate District"))
)
colnames(rpt_index) <- c("dropdown", "column","geography")
runApp()
View(rpt_index)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
View(rpt_lst)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
View(rpt_lst)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
load("D:/Users/nzhu/eitc/data_load.R")
pums_ramp <- leaflet::colorBin(
palette = brewer.pal(7, "Reds"),
bins = classIntervals(puma_units$EstEITC_QTU, 7, style = "fisher")$brks,
na.color = "#808080"
)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
rsconnect::deployApp()
save.image("data.RData")
rsconnect::deployApp()
runApp()
runApp()
View(charities)
load("D:/Users/nzhu/eitc/data.RData")
runApp()
runApp()
load("D:/Users/nzhu/eitc/data.RData")
runApp()
load("data.RData")
runApp()
runApp()
runApp()
charity_bene <- icons(
iconUrl = "charity_icon/bene.png",
iconWidth = 15, iconHeight = 15
)
charity_house <- icons(
iconUrl = "charity_icon/house.png",
iconWidth = 15, iconHeight = 15
)
save.image('data.RData')
load('data.RData')
runApp()
rsconnect::deployApp()
load("data.RData")
rsconnect::deployApp()
rsconnect::deployApp()
rsconnect::deployApp()
View(rpt_index)
names(rpt_lst)
rsconnect::deployApp()
runApp()
runApp()
rsconnect::deployApp()
rsconnect::deployApp()
